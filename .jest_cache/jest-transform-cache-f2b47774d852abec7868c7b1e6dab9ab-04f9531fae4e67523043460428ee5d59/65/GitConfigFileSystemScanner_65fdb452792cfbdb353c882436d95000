b8022526abfa3d15f4ff81a54f03ddb4
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const GitConfigPathToFilePathMapper_1 = require("./GitConfigPathToFilePathMapper");
const promises_1 = __importDefault(require("fs/promises"));
const SpawnPromise_1 = require("../../services/PromisifiedNodeUtilities/SpawnPromise");
const GitProjectConfigFileParser_1 = require("./GitProjectConfigFileParser");
const ApplicationSettingService_1 = require("../../appSettings/services/ApplicationSettingService");
class GitConfigFileSystemScanner {
    static scan(scanStartPath) {
        return __awaiter(this, void 0, void 0, function* () {
            const settings = yield ApplicationSettingService_1.ApplicationSettingService.getSettings();
            const response = {
                configList: [],
                globalUser: undefined,
            };
            // check project path exists
            if (!fs_1.default.existsSync(scanStartPath)) {
                throw new Error(`Git Config file project directory not found (${scanStartPath})`);
            }
            // scan the project path for matching config files
            const gitConfigFilePaths = yield GitConfigFileSystemScanner.getListOfPathsToGitConfigFiles(scanStartPath, settings.globalGitConfigFile);
            // create promises for each file to get the contents
            const fileReadPromises = gitConfigFilePaths.map(fInfo => {
                return promises_1.default.readFile(fInfo);
            });
            // run all the promises to read file input
            const results = yield Promise.allSettled(fileReadPromises);
            // parse the user from the global config file as a special case
            if (results[0].status === 'fulfilled') {
                response.globalUser = GitProjectConfigFileParser_1.GitProjectConfigFileParser.parseGitUser(results[0].value.toString());
            }
            // parse all the project files skipping the first because it's
            // the global config, also add that offset to the file paths
            // in the response
            const GLOBAL_CONFIG_OFFSET = 1;
            const parsedIniFiles = results
                .slice(GLOBAL_CONFIG_OFFSET) // skip the first one (global config)
                .map((r, i) => {
                if (r.status === 'fulfilled') {
                    return GitProjectConfigFileParser_1.GitProjectConfigFileParser.parseGitProjectConfig(r.value.toString(), gitConfigFilePaths[i + GLOBAL_CONFIG_OFFSET]);
                }
                return undefined;
            })
                .filter(x => x !== undefined); // remove any failed ones
            // REMOVED FOR NOW
            // now parse all the individual custom users from each config
            //   response.allCustomUsers = parsedIniFiles
            //     .filter(gitConfig => gitConfig.user?.email || gitConfig.user?.name)
            //     .map(gitConfig => gitConfig.user)
            //     .filter((value, index, self) => {
            //       return (
            //         self.findIndex(
            //           v => v.email === value.email && v.name === value.name
            //         ) === index
            //       )
            //     })
            response.configList = parsedIniFiles;
            return response;
        });
    }
    static getListOfPathsToGitConfigFiles(scanStartPath, globalGitConfigFilePath) {
        return __awaiter(this, void 0, void 0, function* () {
            const settings = yield ApplicationSettingService_1.ApplicationSettingService.getSettings();
            // eslint-disable-next-line prefer-const
            let stdout = '';
            // scan the file system for a list of files
            yield GitConfigFileSystemScanner.scanFileSystem(stdout, scanStartPath);
            const mappedPaths = GitConfigPathToFilePathMapper_1.GitConfigPathToFilePathMapper.map(settings.projectsPath, stdout);
            // add the git global config file to the array
            const gitConfigFilePaths = [globalGitConfigFilePath].concat(mappedPaths);
            return gitConfigFilePaths;
        });
    }
    static scanFileSystem(stdout, scanStartPath) {
        return __awaiter(this, void 0, void 0, function* () {
            stdout = yield (0, SpawnPromise_1.spawnPromise)('find', [
                '.',
                '-type',
                'd',
                '(',
                '-path',
                './Library',
                '-o',
                '-path',
                './.Trash',
                '-o',
                '-path',
                './.config',
                '-o',
                '-path',
                './.nuget',
                '-o',
                '-path',
                './.vscode',
                '-o',
                '-path',
                './.npm',
                '-o',
                '-path',
                './development/flutter',
                '-o',
                '-path',
                './Virtual Machines.localized',
                '-o',
                '-path',
                './Applications',
                '-o',
                '-path',
                './Movies',
                '-o',
                '-path',
                './Music',
                '-o',
                '-path',
                './Pictures',
                '-o',
                '-path',
                './Public',
                '-o',
                '-path',
                './.antigen',
                '-o',
                '-name',
                'node_modules',
                ')',
                '-prune',
                '-o',
                '-name',
                '.git',
                '-print',
            ], scanStartPath);
            return stdout;
        });
    }
}
exports.default = GitConfigFileSystemScanner;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2RhcnJhZ2hvcmlvcmRhbi9Eb2N1bWVudHMvcGVyc29uYWwtcHJvamVjdHMvc3NoLXRvb2wtbmV3LWVsZWN0cm9uL3NyYy9lbGVjdHJvbi9naXRDb25maWd1cmF0aW9ucy9zZXJ2aWNlcy9HaXRDb25maWdGaWxlU3lzdGVtU2Nhbm5lci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLDRDQUFtQjtBQUNuQixtRkFBK0U7QUFDL0UsMkRBQTZCO0FBQzdCLHVGQUFtRjtBQUNuRiw2RUFBeUU7QUFFekUsb0dBQWdHO0FBR2hHLE1BQXFCLDBCQUEwQjtJQUM3QyxNQUFNLENBQU8sSUFBSSxDQUNmLGFBQXFCOztZQUVyQixNQUFNLFFBQVEsR0FBRyxNQUFNLHFEQUF5QixDQUFDLFdBQVcsRUFBRSxDQUFBO1lBRTlELE1BQU0sUUFBUSxHQUFnQztnQkFDNUMsVUFBVSxFQUFFLEVBQUU7Z0JBQ2QsVUFBVSxFQUFFLFNBQVM7YUFDdEIsQ0FBQTtZQUNELDRCQUE0QjtZQUM1QixJQUFJLENBQUMsWUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDakMsTUFBTSxJQUFJLEtBQUssQ0FDYixnREFBZ0QsYUFBYSxHQUFHLENBQ2pFLENBQUE7YUFDRjtZQUNELGtEQUFrRDtZQUNsRCxNQUFNLGtCQUFrQixHQUN0QixNQUFNLDBCQUEwQixDQUFDLDhCQUE4QixDQUM3RCxhQUFhLEVBQ2IsUUFBUSxDQUFDLG1CQUFtQixDQUM3QixDQUFBO1lBRUgsb0RBQW9EO1lBQ3BELE1BQU0sZ0JBQWdCLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUN0RCxPQUFPLGtCQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQzVCLENBQUMsQ0FBQyxDQUFBO1lBRUYsMENBQTBDO1lBQzFDLE1BQU0sT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1lBRTFELCtEQUErRDtZQUMvRCxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssV0FBVyxFQUFFO2dCQUNyQyxRQUFRLENBQUMsVUFBVSxHQUFHLHVEQUEwQixDQUFDLFlBQVksQ0FDM0QsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FDNUIsQ0FBQTthQUNGO1lBRUQsOERBQThEO1lBQzlELDREQUE0RDtZQUM1RCxrQkFBa0I7WUFDbEIsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUE7WUFDOUIsTUFBTSxjQUFjLEdBQUcsT0FBTztpQkFDM0IsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUMscUNBQXFDO2lCQUNqRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ1osSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLFdBQVcsRUFBRTtvQkFDNUIsT0FBTyx1REFBMEIsQ0FBQyxxQkFBcUIsQ0FDckQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFDbEIsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLG9CQUFvQixDQUFDLENBQzdDLENBQUE7aUJBQ0Y7Z0JBRUQsT0FBTyxTQUFTLENBQUE7WUFDbEIsQ0FBQyxDQUFDO2lCQUNELE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxTQUFTLENBQW9CLENBQUEsQ0FBQyx5QkFBeUI7WUFFNUUsa0JBQWtCO1lBQ2xCLDZEQUE2RDtZQUM3RCw2Q0FBNkM7WUFDN0MsMEVBQTBFO1lBQzFFLHdDQUF3QztZQUN4Qyx3Q0FBd0M7WUFDeEMsaUJBQWlCO1lBQ2pCLDBCQUEwQjtZQUMxQixrRUFBa0U7WUFDbEUsc0JBQXNCO1lBQ3RCLFVBQVU7WUFDVixTQUFTO1lBRVQsUUFBUSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUE7WUFFcEMsT0FBTyxRQUFRLENBQUE7UUFDakIsQ0FBQztLQUFBO0lBRUQsTUFBTSxDQUFPLDhCQUE4QixDQUN6QyxhQUFxQixFQUNyQix1QkFBK0I7O1lBRS9CLE1BQU0sUUFBUSxHQUFHLE1BQU0scURBQXlCLENBQUMsV0FBVyxFQUFFLENBQUE7WUFDOUQsd0NBQXdDO1lBQ3hDLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQTtZQUNmLDJDQUEyQztZQUMzQyxNQUFNLDBCQUEwQixDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUE7WUFDdEUsTUFBTSxXQUFXLEdBQUcsNkRBQTZCLENBQUMsR0FBRyxDQUNuRCxRQUFRLENBQUMsWUFBWSxFQUNyQixNQUFNLENBQ1AsQ0FBQTtZQUVELDhDQUE4QztZQUM5QyxNQUFNLGtCQUFrQixHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUE7WUFFeEUsT0FBTyxrQkFBa0IsQ0FBQTtRQUMzQixDQUFDO0tBQUE7SUFFTyxNQUFNLENBQU8sY0FBYyxDQUFDLE1BQWMsRUFBRSxhQUFxQjs7WUFDdkUsTUFBTSxHQUFHLE1BQU0sSUFBQSwyQkFBWSxFQUN6QixNQUFNLEVBQ047Z0JBQ0UsR0FBRztnQkFDSCxPQUFPO2dCQUNQLEdBQUc7Z0JBQ0gsR0FBRztnQkFDSCxPQUFPO2dCQUNQLFdBQVc7Z0JBQ1gsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFVBQVU7Z0JBQ1YsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFdBQVc7Z0JBQ1gsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFVBQVU7Z0JBQ1YsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFdBQVc7Z0JBQ1gsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFFBQVE7Z0JBQ1IsSUFBSTtnQkFDSixPQUFPO2dCQUNQLHVCQUF1QjtnQkFDdkIsSUFBSTtnQkFDSixPQUFPO2dCQUNQLDhCQUE4QjtnQkFDOUIsSUFBSTtnQkFDSixPQUFPO2dCQUNQLGdCQUFnQjtnQkFDaEIsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFVBQVU7Z0JBQ1YsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFNBQVM7Z0JBQ1QsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFlBQVk7Z0JBQ1osSUFBSTtnQkFDSixPQUFPO2dCQUNQLFVBQVU7Z0JBQ1YsSUFBSTtnQkFDSixPQUFPO2dCQUNQLFlBQVk7Z0JBQ1osSUFBSTtnQkFDSixPQUFPO2dCQUNQLGNBQWM7Z0JBQ2QsR0FBRztnQkFDSCxRQUFRO2dCQUNSLElBQUk7Z0JBQ0osT0FBTztnQkFDUCxNQUFNO2dCQUNOLFFBQVE7YUFDVCxFQUNELGFBQWEsQ0FDZCxDQUFBO1lBQ0QsT0FBTyxNQUFNLENBQUE7UUFDZixDQUFDO0tBQUE7Q0FDRjtBQTdKRCw2Q0E2SkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2RhcnJhZ2hvcmlvcmRhbi9Eb2N1bWVudHMvcGVyc29uYWwtcHJvamVjdHMvc3NoLXRvb2wtbmV3LWVsZWN0cm9uL3NyYy9lbGVjdHJvbi9naXRDb25maWd1cmF0aW9ucy9zZXJ2aWNlcy9HaXRDb25maWdGaWxlU3lzdGVtU2Nhbm5lci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnXG5pbXBvcnQgeyBHaXRDb25maWdQYXRoVG9GaWxlUGF0aE1hcHBlciB9IGZyb20gJy4vR2l0Q29uZmlnUGF0aFRvRmlsZVBhdGhNYXBwZXInXG5pbXBvcnQgZnNwIGZyb20gJ2ZzL3Byb21pc2VzJ1xuaW1wb3J0IHsgc3Bhd25Qcm9taXNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvUHJvbWlzaWZpZWROb2RlVXRpbGl0aWVzL1NwYXduUHJvbWlzZSdcbmltcG9ydCB7IEdpdFByb2plY3RDb25maWdGaWxlUGFyc2VyIH0gZnJvbSAnLi9HaXRQcm9qZWN0Q29uZmlnRmlsZVBhcnNlcidcbmltcG9ydCB7IEdpdENvbmZpZ0luZm8gfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9naXRDb25maWdTeXN0ZW1TY2FubmVyL21vZGVscy9HaXRDb25maWdJbmZvJ1xuaW1wb3J0IHsgQXBwbGljYXRpb25TZXR0aW5nU2VydmljZSB9IGZyb20gJy4uLy4uL2FwcFNldHRpbmdzL3NlcnZpY2VzL0FwcGxpY2F0aW9uU2V0dGluZ1NlcnZpY2UnXG5pbXBvcnQgeyBHaXRDb25maWdGaWxlTGlzdENhY2hlTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvR2l0Q29uZmlnRmlsZUxpc3RDYWNoZU1vZGVsJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHaXRDb25maWdGaWxlU3lzdGVtU2Nhbm5lciB7XG4gIHN0YXRpYyBhc3luYyBzY2FuKFxuICAgIHNjYW5TdGFydFBhdGg6IHN0cmluZ1xuICApOiBQcm9taXNlPEdpdENvbmZpZ0ZpbGVMaXN0Q2FjaGVNb2RlbD4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gYXdhaXQgQXBwbGljYXRpb25TZXR0aW5nU2VydmljZS5nZXRTZXR0aW5ncygpXG5cbiAgICBjb25zdCByZXNwb25zZTogR2l0Q29uZmlnRmlsZUxpc3RDYWNoZU1vZGVsID0ge1xuICAgICAgY29uZmlnTGlzdDogW10sXG4gICAgICBnbG9iYWxVc2VyOiB1bmRlZmluZWQsXG4gICAgfVxuICAgIC8vIGNoZWNrIHByb2plY3QgcGF0aCBleGlzdHNcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoc2NhblN0YXJ0UGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEdpdCBDb25maWcgZmlsZSBwcm9qZWN0IGRpcmVjdG9yeSBub3QgZm91bmQgKCR7c2NhblN0YXJ0UGF0aH0pYFxuICAgICAgKVxuICAgIH1cbiAgICAvLyBzY2FuIHRoZSBwcm9qZWN0IHBhdGggZm9yIG1hdGNoaW5nIGNvbmZpZyBmaWxlc1xuICAgIGNvbnN0IGdpdENvbmZpZ0ZpbGVQYXRocyA9XG4gICAgICBhd2FpdCBHaXRDb25maWdGaWxlU3lzdGVtU2Nhbm5lci5nZXRMaXN0T2ZQYXRoc1RvR2l0Q29uZmlnRmlsZXMoXG4gICAgICAgIHNjYW5TdGFydFBhdGgsXG4gICAgICAgIHNldHRpbmdzLmdsb2JhbEdpdENvbmZpZ0ZpbGVcbiAgICAgIClcblxuICAgIC8vIGNyZWF0ZSBwcm9taXNlcyBmb3IgZWFjaCBmaWxlIHRvIGdldCB0aGUgY29udGVudHNcbiAgICBjb25zdCBmaWxlUmVhZFByb21pc2VzID0gZ2l0Q29uZmlnRmlsZVBhdGhzLm1hcChmSW5mbyA9PiB7XG4gICAgICByZXR1cm4gZnNwLnJlYWRGaWxlKGZJbmZvKVxuICAgIH0pXG5cbiAgICAvLyBydW4gYWxsIHRoZSBwcm9taXNlcyB0byByZWFkIGZpbGUgaW5wdXRcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKGZpbGVSZWFkUHJvbWlzZXMpXG5cbiAgICAvLyBwYXJzZSB0aGUgdXNlciBmcm9tIHRoZSBnbG9iYWwgY29uZmlnIGZpbGUgYXMgYSBzcGVjaWFsIGNhc2VcbiAgICBpZiAocmVzdWx0c1swXS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKSB7XG4gICAgICByZXNwb25zZS5nbG9iYWxVc2VyID0gR2l0UHJvamVjdENvbmZpZ0ZpbGVQYXJzZXIucGFyc2VHaXRVc2VyKFxuICAgICAgICByZXN1bHRzWzBdLnZhbHVlLnRvU3RyaW5nKClcbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBwYXJzZSBhbGwgdGhlIHByb2plY3QgZmlsZXMgc2tpcHBpbmcgdGhlIGZpcnN0IGJlY2F1c2UgaXQnc1xuICAgIC8vIHRoZSBnbG9iYWwgY29uZmlnLCBhbHNvIGFkZCB0aGF0IG9mZnNldCB0byB0aGUgZmlsZSBwYXRoc1xuICAgIC8vIGluIHRoZSByZXNwb25zZVxuICAgIGNvbnN0IEdMT0JBTF9DT05GSUdfT0ZGU0VUID0gMVxuICAgIGNvbnN0IHBhcnNlZEluaUZpbGVzID0gcmVzdWx0c1xuICAgICAgLnNsaWNlKEdMT0JBTF9DT05GSUdfT0ZGU0VUKSAvLyBza2lwIHRoZSBmaXJzdCBvbmUgKGdsb2JhbCBjb25maWcpXG4gICAgICAubWFwKChyLCBpKSA9PiB7XG4gICAgICAgIGlmIChyLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcpIHtcbiAgICAgICAgICByZXR1cm4gR2l0UHJvamVjdENvbmZpZ0ZpbGVQYXJzZXIucGFyc2VHaXRQcm9qZWN0Q29uZmlnKFxuICAgICAgICAgICAgci52YWx1ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgZ2l0Q29uZmlnRmlsZVBhdGhzW2kgKyBHTE9CQUxfQ09ORklHX09GRlNFVF1cbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICB9KVxuICAgICAgLmZpbHRlcih4ID0+IHggIT09IHVuZGVmaW5lZCkgYXMgR2l0Q29uZmlnSW5mb1tdIC8vIHJlbW92ZSBhbnkgZmFpbGVkIG9uZXNcblxuICAgIC8vIFJFTU9WRUQgRk9SIE5PV1xuICAgIC8vIG5vdyBwYXJzZSBhbGwgdGhlIGluZGl2aWR1YWwgY3VzdG9tIHVzZXJzIGZyb20gZWFjaCBjb25maWdcbiAgICAvLyAgIHJlc3BvbnNlLmFsbEN1c3RvbVVzZXJzID0gcGFyc2VkSW5pRmlsZXNcbiAgICAvLyAgICAgLmZpbHRlcihnaXRDb25maWcgPT4gZ2l0Q29uZmlnLnVzZXI/LmVtYWlsIHx8IGdpdENvbmZpZy51c2VyPy5uYW1lKVxuICAgIC8vICAgICAubWFwKGdpdENvbmZpZyA9PiBnaXRDb25maWcudXNlcilcbiAgICAvLyAgICAgLmZpbHRlcigodmFsdWUsIGluZGV4LCBzZWxmKSA9PiB7XG4gICAgLy8gICAgICAgcmV0dXJuIChcbiAgICAvLyAgICAgICAgIHNlbGYuZmluZEluZGV4KFxuICAgIC8vICAgICAgICAgICB2ID0+IHYuZW1haWwgPT09IHZhbHVlLmVtYWlsICYmIHYubmFtZSA9PT0gdmFsdWUubmFtZVxuICAgIC8vICAgICAgICAgKSA9PT0gaW5kZXhcbiAgICAvLyAgICAgICApXG4gICAgLy8gICAgIH0pXG5cbiAgICByZXNwb25zZS5jb25maWdMaXN0ID0gcGFyc2VkSW5pRmlsZXNcblxuICAgIHJldHVybiByZXNwb25zZVxuICB9XG5cbiAgc3RhdGljIGFzeW5jIGdldExpc3RPZlBhdGhzVG9HaXRDb25maWdGaWxlcyhcbiAgICBzY2FuU3RhcnRQYXRoOiBzdHJpbmcsXG4gICAgZ2xvYmFsR2l0Q29uZmlnRmlsZVBhdGg6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBzZXR0aW5ncyA9IGF3YWl0IEFwcGxpY2F0aW9uU2V0dGluZ1NlcnZpY2UuZ2V0U2V0dGluZ3MoKVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcbiAgICBsZXQgc3Rkb3V0ID0gJydcbiAgICAvLyBzY2FuIHRoZSBmaWxlIHN5c3RlbSBmb3IgYSBsaXN0IG9mIGZpbGVzXG4gICAgYXdhaXQgR2l0Q29uZmlnRmlsZVN5c3RlbVNjYW5uZXIuc2NhbkZpbGVTeXN0ZW0oc3Rkb3V0LCBzY2FuU3RhcnRQYXRoKVxuICAgIGNvbnN0IG1hcHBlZFBhdGhzID0gR2l0Q29uZmlnUGF0aFRvRmlsZVBhdGhNYXBwZXIubWFwKFxuICAgICAgc2V0dGluZ3MucHJvamVjdHNQYXRoLFxuICAgICAgc3Rkb3V0XG4gICAgKVxuXG4gICAgLy8gYWRkIHRoZSBnaXQgZ2xvYmFsIGNvbmZpZyBmaWxlIHRvIHRoZSBhcnJheVxuICAgIGNvbnN0IGdpdENvbmZpZ0ZpbGVQYXRocyA9IFtnbG9iYWxHaXRDb25maWdGaWxlUGF0aF0uY29uY2F0KG1hcHBlZFBhdGhzKVxuXG4gICAgcmV0dXJuIGdpdENvbmZpZ0ZpbGVQYXRoc1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgc2NhbkZpbGVTeXN0ZW0oc3Rkb3V0OiBzdHJpbmcsIHNjYW5TdGFydFBhdGg6IHN0cmluZykge1xuICAgIHN0ZG91dCA9IGF3YWl0IHNwYXduUHJvbWlzZShcbiAgICAgICdmaW5kJyxcbiAgICAgIFtcbiAgICAgICAgJy4nLFxuICAgICAgICAnLXR5cGUnLFxuICAgICAgICAnZCcsXG4gICAgICAgICcoJyxcbiAgICAgICAgJy1wYXRoJyxcbiAgICAgICAgJy4vTGlicmFyeScsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuLy5UcmFzaCcsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuLy5jb25maWcnLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLXBhdGgnLFxuICAgICAgICAnLi8ubnVnZXQnLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLXBhdGgnLFxuICAgICAgICAnLi8udnNjb2RlJyxcbiAgICAgICAgJy1vJyxcbiAgICAgICAgJy1wYXRoJyxcbiAgICAgICAgJy4vLm5wbScsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuL2RldmVsb3BtZW50L2ZsdXR0ZXInLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLXBhdGgnLFxuICAgICAgICAnLi9WaXJ0dWFsIE1hY2hpbmVzLmxvY2FsaXplZCcsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuL0FwcGxpY2F0aW9ucycsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuL01vdmllcycsXG4gICAgICAgICctbycsXG4gICAgICAgICctcGF0aCcsXG4gICAgICAgICcuL011c2ljJyxcbiAgICAgICAgJy1vJyxcbiAgICAgICAgJy1wYXRoJyxcbiAgICAgICAgJy4vUGljdHVyZXMnLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLXBhdGgnLFxuICAgICAgICAnLi9QdWJsaWMnLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLXBhdGgnLFxuICAgICAgICAnLi8uYW50aWdlbicsXG4gICAgICAgICctbycsXG4gICAgICAgICctbmFtZScsXG4gICAgICAgICdub2RlX21vZHVsZXMnLFxuICAgICAgICAnKScsXG4gICAgICAgICctcHJ1bmUnLFxuICAgICAgICAnLW8nLFxuICAgICAgICAnLW5hbWUnLFxuICAgICAgICAnLmdpdCcsXG4gICAgICAgICctcHJpbnQnLFxuICAgICAgXSxcbiAgICAgIHNjYW5TdGFydFBhdGhcbiAgICApXG4gICAgcmV0dXJuIHN0ZG91dFxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=